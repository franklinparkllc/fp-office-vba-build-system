# VBA App Builder - A Modern Build System for Microsoft Office
## üöÄ Overview
Modern build system for VBA development, optimized for AI-driven workflows. This system transforms VBA development by enabling version control, automated builds, and modern development practices with minimal complexity.
## ‚ú® What Makes This Special
### **Before VBA App Builder**
- ‚ùå Code trapped inside Office documents
- ‚ùå No version control for VBA code
- ‚ùå Manual, error-prone form creation and management
- ‚ùå No automated deployment process

### **After VBA App Builder**
- ‚úÖ **Source-Controlled Code**: All VBA code lives in text files, perfect for Git.
- ‚úÖ **Automated Form Generation**: Build complex UserForms directly from `design.json` files.
- ‚úÖ **Zero Configuration**: No persistent settings - select your source folder each time you build.
- ‚úÖ **Single Module Simplicity**: The entire build system in one self-contained VBA module.
- ‚úÖ **AI-Optimized**: Designed for agentic workflows, enabling AI to generate, build, and test applications.
- ‚úÖ **Enhanced UX**: Progress tracking, better error messages, and auto-save options.

## üîß How It Works: The Direct Injection Method
The build system works by directly manipulating the VBA project within the host Office application (Word, Excel, etc.). It reads source files from your `src` directory and injects them into the VBA environment.

### 1. **Direct Form Creation**
Instead of relying on a fragile export/import process, the builder creates forms from scratch, overcoming wellknown limitations of the VBA environment.
```vba
' Create a new, empty form component
Set formComp = vbProj.VBComponents.Add(vbext_ct_MSForm)
' Apply all properties from design.json (caption, size, etc.)
Call ApplyDesign(formComp, design)
' PAUSE to allow the VBE to process the new object
DoEvents: Sleep 500
' Programmatically rename the form to its correct name
formComp.Properties("Name").Value = formName
```
### 2. **Simple JSON Parsing**
A lightweight, regex-based parser reads `manifest.json` and `design.json` files. It's fast, reliable, and has no external dependencies.
```vba
' Extract all key/value pairs from a JSON file
Set dict = ParseJSON(jsonText)
' Access values directly
formComp.Properties("Width").Value = dict("width")
```
### 3. **Module & Code-Behind Injection**
Standard modules (`.vba`) are imported directly, and form code-behinds are injected into the form's `CodeModule`.
```vba
' Import a standard module from a .vba file
Set comp = vbProj.VBComponents.Import(filePath)
' Add event handlers and logic to a form
formComp.CodeModule.AddFromString codeContent
```
## üèóÔ∏è **System Architecture (v2.1 - Simplified Edition)**
**Single-module design**: Everything you need in one file with zero configuration.

### **üë§ User Experience - Just 2 Main Functions!**
```vba
Call Build()                        ' Browse for folder, select app, build
Call BuildApplication("AppName")    ' Browse for folder, build specific app
```

### **modAppBuilder.bas** - Complete Build System
- **üéØ User Functions**:
  - `Build()` - Browse for source folder and select app to build
  - `BuildApplication(appName)` - Build specific app (prompts for folder)
  - `ConfigureAutoSave()` - Toggle auto-save preference
  - `ShowSystemStatus()` - Display version and available commands
- **üîß Core Features**:
  - `CreateFormDirect()` - Robust form creation with enhanced error handling
  - `ProcessModules()` - Module importing with progress tracking
  - `JSON Comment Support` - Allows // comments in JSON files
  - `JSON Validation` - Reports line numbers for syntax errors
  - `Progress Tracking` - Real-time build progress in Immediate window

### **üöÄ Key Features**:
- ‚úÖ **Zero Configuration**: No setup required - just import and use
- ‚úÖ **Single Module**: All functionality in one easy-to-distribute file
- ‚úÖ **Fresh Folder Selection**: Choose your project folder each time
- ‚úÖ **Enhanced Error Messages**: Helpful suggestions for common issues
- ‚úÖ **Progress Tracking**: See exactly what's happening during builds
- ‚úÖ **JSON Comments**: Add // comments to your JSON files
- ‚úÖ **Auto-Save Option**: Optionally save project after successful builds
## üìÅ **Project Structure**
```
fp-office-vba-build-system/
‚îú‚îÄ‚îÄ modAppBuilder.bas      # Complete build system (v2.1)
‚îú‚îÄ‚îÄ ExampleApp/            # Reference application (at root for easy access)
‚îÇ   ‚îú‚îÄ‚îÄ manifest.json      # App config: name, modules, forms
‚îÇ   ‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ modExampleApp.vba
‚îÇ   ‚îî‚îÄ‚îÄ forms/
‚îÇ       ‚îî‚îÄ‚îÄ frmExampleApp/
‚îÇ           ‚îú‚îÄ‚îÄ design.json      # Form layout: size, caption, controls
‚îÇ           ‚îî‚îÄ‚îÄ code-behind.vba  # The form's event-handling code
‚îî‚îÄ‚îÄ YourAppsFolder/        # Your applications go here
    ‚îî‚îÄ‚îÄ YourApp/
        ‚îú‚îÄ‚îÄ manifest.json
        ‚îú‚îÄ‚îÄ modules/
        ‚îî‚îÄ‚îÄ forms/
```
## üöÄ **Quick Start**
### **1. Setup VBA App Builder**
1.  **Open any Office document** (Excel, Word, etc.) and save it as a macro-enabled file (e.g., `.docm` or `.xlsm`). This will be your build environment.
2.  **Press `Alt+F11`** to open the VBA Editor.
3.  **Insert ‚Üí Module** and name it `modAppBuilder`.
4.  **Copy the entire contents** of `modAppBuilder.bas` into the module.
### **2. Enable Trust Center Settings**
**CRITICAL**: You must allow programmatic access to the VBA project.
1.  In your Office Application: **File ‚Üí Options ‚Üí Trust Center**.
2.  **Trust Center Settings ‚Üí Macro Settings**.
3.  **‚úÖ Check "Trust access to the VBA project object model"**.
4.  **Restart the Office application**.
### **3. Start Building! (Zero Configuration)**
```vba
' Open the Immediate Window (View -> Immediate Window or Ctrl+G) and run:

' Build apps (browse for folder, select app)
Call Build()

' Or build specific app directly
Call BuildApplication("ExampleApp")

' Optional: Configure auto-save
Call ConfigureAutoSave()

' Optional: Check version and commands
Call ShowSystemStatus()
```
## üìã **Application Configuration**
### **Simplified Manifest.json**
This file defines your application's components.
```json
{
  "name": "MyApp",
  "version": "1.0.0",
  "modules": "modMyModule",
  "forms": "frmMyForm"
}
```
### **Design.json Schema (with Comments!)**
Clean separation between form properties and controls, now with comment support.
```json
{
  // Form properties section
  "form": {
    "name": "frmMyApp",
    "caption": "My Application", 
    "width": 400,
    "height": 300,
    "startUpPosition": 1  // 0=Manual, 1=CenterOwner, 2=CenterScreen, 3=WindowsDefault
  },
  // Controls array - add buttons, labels, etc.
  "controls": [
    {
      "name": "btnSubmit",
      "type": "CommandButton", 
      "caption": "Submit",
      "left": 50, "top": 50, "width": 100, "height": 30,
      // Optional font settings
      "font": {
        "name": "Arial",
        "size": 10,
        "bold": true,
        "italic": false
      }
    }
  ]
}
```

**üéØ Enhanced Features:**
- ‚úÖ **JSON Comments**: Use // for single-line comments
- ‚úÖ **Font Support**: Customize control fonts
- ‚úÖ **Clear Structure**: Form properties separate from controls
- ‚úÖ **AI-Friendly**: Easy for code generation
- ‚úÖ **Error Reporting**: Get line numbers for JSON syntax errors
## üéØ **The Direct VBA Object Strategy**
After a successful build, your forms and modules exist as **native VBA objects**. You should always reference them directly in your code.
### ‚úÖ **Recommended Approach**
```vba
' Launch forms using their given name
frmMyForm.Show
' Call module functions directly
Call modMyModule.MyFunction()
' Access form properties directly
frmMyForm.Caption = "New Title"
```
### üö´ Critical Rule: Never reference placeholder names like "UserForm1"
- Always assume build-created objects exist with their manifest/design names.
- The build process ensures these objects are created before your code runs. Do not write code that references ephemeral placeholder names such as `UserForm1`, as they are not guaranteed to exist.
## üìö **Reference Applications**
### **ExampleApp** - Reference Template üéØ
- **Purpose**: A comprehensive template for developers and AI assistants.
- **Features**: A fully annotated application demonstrating all VBA Build System patterns.
- **Use Case**: Copy this structure when creating new applications.
- **Location**: `ExampleApp/` (at root level for easy access)
### **FundSelector** - Production Example
- **Purpose**: A database-driven fund selection tool.
- **Features**: Demonstrates Azure SQL connectivity and a professional UI.
- **Use Case**: A real-world business application.
## üîß **System Commands**
```vba
' üéØ Essential Commands
Call Build()                         ' Browse for folder, show menu, build selected app
Call BuildApplication("AppName")     ' Browse for folder, build specific app

' üîß Configuration & Info
Call ConfigureAutoSave()             ' Toggle auto-save on/off
Call ShowSystemStatus()              ' Display version and available commands

' üîç Diagnostics (if needed)
Call ValidateTrustSettings()         ' Check VBA project access
```
## üõ†Ô∏è **The Form Build Process Explained**
The system uses a robust, multi-step process to overcome the quirks of the VBE and reliably generate forms.
1.  **Create**: A new, blank `MSForm` component is added to the project with a temporary name (e.g., `UserForm1`).
2.  **Apply Design**: The system reads your `design.json` and programmatically applies all properties (caption, size, etc.) and adds all specified controls to the new form.
3.  **Pause**: A brief, 500ms pause allows the VBE to finish processing the new form and its controls, preventing race conditions.
4.  **Rename**: With the form fully created, the system renames it from its temporary name to the name specified in your configuration (e.g., `frmExampleApp`).
5.  **Inject Code**: The associated `code-behind.vba` file is read and injected into the form's code module.
6.  **Save**: The host document is saved to persist all changes to the VBA project.
## üö® **Troubleshooting**
### **Common Issues**
1.  **"VBA Project access is disabled"**
    -   ‚úÖ Enable "Trust access to the VBA project object model" in Trust Center and restart.
2.  **"Build failed during processing"**
    -   ‚úÖ Check the file paths shown in `ShowSystemStatus()`.
    -   ‚úÖ Verify the syntax of your `manifest.json` and `design.json` files.
3.  **"Application not found"**
    -   ‚úÖ Check `ShowSystemStatus()` to see available applications.
    -   ‚úÖ Ensure your application folder in `src` contains a valid `manifest.json`.
### **Diagnostic Steps**
```vba
' Step 1: Check system status
Call ShowSystemStatus()
' Step 2: Validate Trust Center settings  
Call ValidateTrustSettings()
' Step 3: Try building with menu
Call Build()
' Step 4: Check auto-save settings
Call ConfigureAutoSave()
```
## üèÜ **Benefits**
### **For Developers**
-   **Modern Workflow**: Develop VBA using modern IDEs (VS Code, Cursor).
-   **Version Control**: Full Git integration for all your code.
-   **Collaboration**: Team development with proper source control.
-   **Native Experience**: Debugging and IntelliSense work perfectly.
### **For Organizations**
-   **Standardization**: Consistent, repeatable builds and deployments.
-   **Quality Control**: Automated build validation.
-   **Maintainability**: Easier updates and bug fixes.
### **For AI Assistants: Enhanced Code Generation**
-   **Comment-Friendly JSON**: Generate design files with helpful // comments.
-   **Better Error Messages**: Line numbers in JSON errors make debugging easier.
-   **Progress Tracking**: Monitor build progress programmatically.
-   **Single Module**: Everything in one file - simpler to understand and generate for.
---
## üéâ **Ready for Modern VBA Development?**
The **v2.1 system** brings zero-configuration simplicity with enhanced user experience!

```vba
' Ultra-simple workflow:
Call Build()         ' Browse, select, build - all in one!
```

**What's New in v2.1:**
- üöÄ **Zero Configuration** - No setup, no stored paths
- üìä **Progress Tracking** - See build progress in real-time
- üí¨ **JSON Comments** - Add documentation to your config files
- üîç **Better Errors** - Helpful messages with recovery suggestions
- üíæ **Auto-Save Option** - Save project after successful builds
- üì¶ **Single Module** - Everything in one easy-to-share file

**Perfect for:**
- ü§ñ **AI Code Generation** - Enhanced JSON support and error handling
- üë®‚Äçüíª **Developers** - Modern workflow with better UX
- üè¢ **Organizations** - Zero-config deployment
- üìö **Learning** - Clearer error messages and progress feedback